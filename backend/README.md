# File Structure
- `go-graphql/`
    - This has all of the code for the Go Graphql server
    - `server.go` is the entry point for the server which has logic for running code on Lambda or on a server
    - `graph/`
        - A lot of this code is generated by gqlgen based on our `schema.graphqls` file
        - `schema.resolvers.go` has the actual server code which resolves our queries and mutations
- `serverless/`
    - Individual YAML files for our Cognito configuration, DynamoDB tables, and Go Lambda function for GraphQL

# Local Development
See `run-local.sh` at the project root. This shell file can be run for Gnome terminals and will create separate terminal tabs running:
- Local React site
- Local Go server
- Local DynamoDB instance (loses data on restart)
- Local DynamoDB viewer

# Deploying
The `server.go` file checks environment variables at runtime to determine whether to run Lambda code or to run a normal server. So the same code can be run from Lambda or my Raspberry Pi.

## Deploying to Raspberry Pi
To run on my Raspberry Pi I just need to run:
```
cd go-graphql
go run server.go
```

- This starts the backend graphql server on port 8080
- This server enables CORS for the site's domain
- This server enables HTTPS by relying on certificates generated by Lets Encrypt Bot on the Raspberry Pi

## Deploying to Lambda
On a Linux machine (using Ubuntu 21 currently) run:
```
cd go-graphql
make
cd ../serverless
sls deploy
```

- This will build the Go server as a Linux executable and will create the file `serverless/bin/go-server`
- Running `sls deploy` will deploy/update our Cognito configuration, DynamoDB tables, and a Lambda function that points to our Go Graphql code
- The Lambda function enables CORS